"use strict";
/*!
 * Copyright 2019 Palantir Technologies, Inc.
 *
 * Licensed under the MIT license. See LICENSE file in the project root for details.
 *
 */
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const fs_1 = require("fs");
const glob_1 = tslib_1.__importDefault(require("glob"));
const path_1 = require("path");
const readJson_1 = require("./readJson");
function getWorkspacePackageDirs(workspaceDir, resolvePaths = false) {
    const ret = [];
    const packageJson = readJson_1.readJson(path_1.join(workspaceDir, "package.json"));
    if (packageJson.workspaces === undefined) {
        throw new Error("Invalid workspaceDir: " + workspaceDir);
    }
    const packageGlobs = Array.isArray(packageJson.workspaces)
        ? packageJson.workspaces
        : packageJson.workspaces.packages || [];
    for (const pattern of packageGlobs) {
        for (const packagePath of glob_1.default.sync(pattern, { cwd: workspaceDir })) {
            const packageJsonPath = path_1.join(workspaceDir, packagePath, "package.json");
            if (fs_1.existsSync(packageJsonPath)) {
                if (resolvePaths === true) {
                    ret.push(path_1.resolve(path_1.join(workspaceDir, packagePath)));
                }
                else {
                    ret.push(packagePath);
                }
            }
        }
    }
    return ret;
}
exports.getWorkspacePackageDirs = getWorkspacePackageDirs;
//# sourceMappingURL=getWorkspacePackageDirs.js.map